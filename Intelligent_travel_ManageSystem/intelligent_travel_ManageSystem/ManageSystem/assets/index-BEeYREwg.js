import{d as H,r as v,a2 as me,o as Q,q as ge,c as A,e as b,b as t,T as W,w as o,l as g,m as w,p as _,_ as X,I as K,E as _e,J as ve,f as ye,h as be,i as Ve,j as Ie,K as Ce,L as P,M as T,a1 as ke,k as Ae,B as D,N as xe,t as Me,O as Ee,v as he,P as $,Q as we,D as B,U as Se,V as je,W as ze,x as Ue,z as Pe,a3 as Te,$ as De,a0 as $e}from"./index-Bh04lDP-.js";/* empty css                   */import{g as Be}from"./ich-Dffa0FPv.js";/* empty css                 *//* empty css               *//* empty css                        *//* empty css                *//* empty css                     */import{A as Z,a as Ne,b as Oe,c as Fe,u as Ke,d as Re}from"./index-CSyRSZWU.js";const qe={class:"map-picker-container"},Le={class:"tips"},Ge="ae49d6da7c2b2e512cfd0eee52a8e84a",Ye="b53b60a2ff86751a31550af6a570fc7b",Je=H({__name:"index",props:{lat:{},lng:{},searchAddress:{}},emits:["update:lat","update:lng","select"],setup(R,{emit:S}){const s=R,V=S,x=v(null);let c=null,f=null;const r=async()=>{try{window._AMapSecurityConfig={securityJsCode:Ye};const i=await Z.load({key:Ge,version:"2.0",plugins:["AMap.Marker","AMap.Geocoder"]}),d=s.lng&&s.lat?[s.lng,s.lat]:[113.2644,23.1291];c=new i.Map(x.value,{zoom:13,center:d}),s.lng&&s.lat&&y(i,s.lng,s.lat),c.on("click",u=>{const{lng:n,lat:I}=u.lnglat;y(i,n,I),V("update:lng",n),V("update:lat",I),V("select",{lng:n,lat:I}),w.success(`已选中坐标: ${n.toFixed(6)}, ${I.toFixed(6)}`)})}catch(i){console.error("地图加载失败",i),w.error("地图加载失败，请检查 Key")}},y=(i,d,u)=>{f?f.setPosition([d,u]):f=new i.Marker({position:[d,u],map:c})};return me(()=>[s.lng,s.lat],([i,d])=>{if(i&&d&&c){const u=window.AMap;u&&(y(u,i,d),c.setCenter([i,d]))}}),Q(()=>{r()}),ge(()=>{c&&c.destroy()}),(i,d)=>{const u=W;return _(),A("div",qe,[b("div",{ref_key:"mapContainer",ref:x,class:"map-container"},null,512),b("div",Le,[t(u,{type:"info",size:"small"},{default:o(()=>[...d[0]||(d[0]=[g("操作提示",-1)])]),_:1}),d[1]||(d[1]=b("span",{style:{"font-size":"12px","margin-left":"8px",color:"#666"}}," 点击地图任意位置即可选取坐标；滚动鼠标缩放地图。 ",-1))])])}}}),He=X(Je,[["__scopeId","data-v-b82b1490"]]),Qe={class:"app-container"},We={class:"toolbar"},Xe={key:1,style:{color:"#999","font-size":"12px"}},Ze={style:{display:"flex","align-items":"center","justify-content":"center",gap:"5px"}},ea={style:{color:"#ff9900","font-weight":"bold","font-size":"16px"}},aa={class:"pagination"},ta="ae49d6da7c2b2e512cfd0eee52a8e84a",la="b53b60a2ff86751a31550af6a570fc7b",oa=H({__name:"index",setup(R){window._AMapSecurityConfig={securityJsCode:la};const S=v(!1),s=v([]),V=v([]),x=v(0),c=v([]),f=K({}),r=K({current:1,pageSize:10,name:"",category:"",projectId:void 0,sortType:"default"}),y=v(!1),i=v("add"),d=v(!1),u=v(),n=K({id:void 0,name:"",category:"",projectId:void 0,address:"",phone:"",lat:void 0,lng:void 0,rating:5,relevanceScore:80}),I=["体验馆","文创店","老字号","博物馆","研学基地"],ee={name:[{required:!0,message:"请输入商户名称",trigger:"blur"}],category:[{required:!0,message:"请选择商户类别",trigger:"change"}]};let j=null;const ae=async()=>{try{const l=await Z.load({key:ta,version:"2.0",plugins:["AMap.Geocoder"]});j=new l.Geocoder,s.value.length>0&&s.value.forEach(e=>N(e))}catch(l){console.error("地图加载失败",l)}},N=l=>l.address?l.address:f[l.id]?f[l.id]:l.lat&&l.lng&&(f[l.id]||(f[l.id]="地址加载中..."),j)?(j.getAddress([l.lng,l.lat],(e,m)=>{e==="complete"&&m.regeocode?f[l.id]=m.regeocode.formattedAddress:f[l.id]="地址解析失败"}),f[l.id]):"暂无坐标",te=async()=>{try{const l=await Be({current:1,pageSize:1e3});c.value=l.data.records}catch(l){console.error(l)}},M=async()=>{S.value=!0;try{if(r.sortType==="default"){const l=await Ne({current:r.current,pageSize:r.pageSize,name:r.name,category:r.category,projectId:r.projectId});s.value=l.data.records,x.value=typeof l.data.total=="string"?parseInt(l.data.total):l.data.total}else{const l=await Oe(100);V.value=l.data||[],x.value=V.value.length,O()}j&&s.value.forEach(l=>N(l))}finally{S.value=!1}},O=()=>{if(r.sortType==="rating"){const l=(r.current-1)*r.pageSize,e=l+r.pageSize;s.value=V.value.slice(l,e),j&&s.value.forEach(m=>N(m))}},U=()=>{r.current=1,M()},le=()=>{r.name="",r.category="",r.projectId=void 0,r.sortType="default",U()},oe=l=>{r.current=l,r.sortType==="default"?M():O()},ne=l=>{r.pageSize=l,r.current=1,r.sortType==="default"?M():O()},q=(l,e)=>{i.value=l,y.value=!0,l==="edit"&&e?(Object.assign(n,e),n.projectId=e.projectId?Number(e.projectId):void 0):(n.id=void 0,n.name="",n.category="",n.projectId=void 0,n.address="",n.phone="",n.lat=void 0,n.lng=void 0,n.rating=5,n.relevanceScore=80)},re=async()=>{u.value&&await u.value.validate(async l=>{if(l){if(!n.lat||!n.lng){w.warning("请在地图上点击选择商户位置");return}d.value=!0;try{i.value==="add"?(await Fe(n),w.success("新增成功")):(await Ke(n.id,n),w.success("更新成功")),y.value=!1,M()}catch(e){console.error(e)}finally{d.value=!1}}})},se=l=>{De.confirm("确定要删除该商户吗？","提示",{type:"warning"}).then(async()=>{await Re(l.id),w.success("删除成功"),M()})},de=l=>{if(!l)return"";const e=c.value.find(m=>m.id===l);return e?e.name:`ID:${l}`};return Q(()=>{te(),ae(),M()}),(l,e)=>{const m=Ve,p=be,E=ke,z=Ce,C=Ae,L=ye,G=_e,k=we,Y=W,ie=$e,ue=ze,h=Pe,F=Ue,J=Te,pe=ve,ce=he;return _(),A("div",Qe,[t(G,{shadow:"never",class:"search-card"},{default:o(()=>[t(L,{inline:!0,model:r},{default:o(()=>[t(p,{label:"商户名称"},{default:o(()=>[t(m,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),placeholder:"支持模糊搜索",clearable:"",onKeyup:Ie(U,["enter"])},null,8,["modelValue"])]),_:1}),t(p,{label:"类别"},{default:o(()=>[t(z,{modelValue:r.category,"onUpdate:modelValue":e[1]||(e[1]=a=>r.category=a),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:o(()=>[(_(),A(P,null,T(I,a=>t(E,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"关联项目"},{default:o(()=>[t(z,{modelValue:r.projectId,"onUpdate:modelValue":e[2]||(e[2]=a=>r.projectId=a),placeholder:"全部",clearable:"",filterable:"",style:{width:"140px"}},{default:o(()=>[(_(!0),A(P,null,T(c.value,a=>(_(),$(E,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"排序方式"},{default:o(()=>[t(z,{modelValue:r.sortType,"onUpdate:modelValue":e[3]||(e[3]=a=>r.sortType=a),placeholder:"默认",style:{width:"140px"},onChange:U},{default:o(()=>[t(E,{label:"默认排序",value:"default"}),t(E,{label:"评分: 高→低",value:"rating"})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:o(()=>[t(C,{type:"primary",icon:D(xe),onClick:U},{default:o(()=>[...e[18]||(e[18]=[g("搜索",-1)])]),_:1},8,["icon"]),t(C,{onClick:le},{default:o(()=>[...e[19]||(e[19]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(G,{shadow:"never"},{default:o(()=>[b("div",We,[t(C,{type:"primary",icon:D(Ee),onClick:e[4]||(e[4]=a=>q("add"))},{default:o(()=>[...e[20]||(e[20]=[g("新增商户",-1)])]),_:1},8,["icon"])]),Me((_(),$(ie,{data:s.value,border:"",stripe:""},{default:o(()=>[t(k,{prop:"id",label:"ID",width:"80",align:"center"}),t(k,{prop:"name",label:"商户名称","min-width":"150","show-overflow-tooltip":""}),t(k,{prop:"category",label:"类别",width:"100",align:"center"},{default:o(({row:a})=>[t(Y,{type:"info"},{default:o(()=>[g(B(a.category),1)]),_:2},1024)]),_:1}),t(k,{label:"关联项目",width:"150",align:"center"},{default:o(({row:a})=>[a.projectId?(_(),$(Y,{key:0,effect:"plain"},{default:o(()=>[g(B(de(a.projectId)),1)]),_:2},1024)):(_(),A("span",Xe,"暂无"))]),_:1}),t(k,{prop:"rating",label:"评分",width:"100",align:"center",sortable:"custom"},{default:o(({row:a})=>[b("div",Ze,[b("span",ea,B(a.rating),1),e[21]||(e[21]=b("span",{style:{color:"#999","font-size":"12px"}},"分",-1))])]),_:1}),t(k,{label:"地址","min-width":"200","show-overflow-tooltip":""},{default:o(({row:a})=>[g(B(f[a.id]||a.address||"暂无"),1)]),_:1}),t(k,{label:"操作",width:"180",fixed:"right",align:"center"},{default:o(({row:a})=>[t(C,{link:"",type:"primary",icon:D(Se),onClick:fe=>q("edit",a)},{default:o(()=>[...e[22]||(e[22]=[g("编辑",-1)])]),_:1},8,["icon","onClick"]),t(C,{link:"",type:"danger",icon:D(je),onClick:fe=>se(a)},{default:o(()=>[...e[23]||(e[23]=[g("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ce,S.value]]),b("div",aa,[t(ue,{"current-page":r.current,"onUpdate:currentPage":e[5]||(e[5]=a=>r.current=a),"page-size":r.pageSize,"onUpdate:pageSize":e[6]||(e[6]=a=>r.pageSize=a),total:x.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:oe,onSizeChange:ne},null,8,["current-page","page-size","total"])])]),_:1}),t(pe,{modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=a=>y.value=a),title:i.value==="add"?"新增商户":"编辑商户",width:"700px",top:"5vh"},{footer:o(()=>[t(C,{onClick:e[16]||(e[16]=a=>y.value=!1)},{default:o(()=>[...e[24]||(e[24]=[g("取消",-1)])]),_:1}),t(C,{type:"primary",loading:d.value,onClick:re},{default:o(()=>[...e[25]||(e[25]=[g("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(L,{ref_key:"formRef",ref:u,model:n,rules:ee,"label-width":"100px"},{default:o(()=>[t(F,{gutter:20},{default:o(()=>[t(h,{span:12},{default:o(()=>[t(p,{label:"商户名称",prop:"name"},{default:o(()=>[t(m,{modelValue:n.name,"onUpdate:modelValue":e[7]||(e[7]=a=>n.name=a),placeholder:"请输入店铺名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:o(()=>[t(p,{label:"联系电话",prop:"phone"},{default:o(()=>[t(m,{modelValue:n.phone,"onUpdate:modelValue":e[8]||(e[8]=a=>n.phone=a),placeholder:"请输入电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(F,{gutter:20},{default:o(()=>[t(h,{span:12},{default:o(()=>[t(p,{label:"类别",prop:"category"},{default:o(()=>[t(z,{modelValue:n.category,"onUpdate:modelValue":e[9]||(e[9]=a=>n.category=a),style:{width:"100%"}},{default:o(()=>[(_(),A(P,null,T(I,a=>t(E,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:o(()=>[t(p,{label:"关联项目",prop:"projectId"},{default:o(()=>[t(z,{modelValue:n.projectId,"onUpdate:modelValue":e[10]||(e[10]=a=>n.projectId=a),placeholder:"请选择关联非遗项目",style:{width:"100%"},filterable:"",clearable:""},{default:o(()=>[(_(!0),A(P,null,T(c.value,a=>(_(),$(E,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(F,{gutter:20},{default:o(()=>[t(h,{span:12},{default:o(()=>[t(p,{label:"评分"},{default:o(()=>[t(J,{modelValue:n.rating,"onUpdate:modelValue":e[11]||(e[11]=a=>n.rating=a),min:0,max:5,precision:1,step:.1},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:o(()=>[t(p,{label:"关联度"},{default:o(()=>[t(J,{modelValue:n.relevanceScore,"onUpdate:modelValue":e[12]||(e[12]=a=>n.relevanceScore=a),min:0,max:100},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(p,{label:"详细地址",prop:"address"},{default:o(()=>[t(m,{modelValue:n.address,"onUpdate:modelValue":e[13]||(e[13]=a=>n.address=a),placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1}),t(p,{label:"地图定位",required:""},{default:o(()=>[t(He,{lat:n.lat,"onUpdate:lat":e[14]||(e[14]=a=>n.lat=a),lng:n.lng,"onUpdate:lng":e[15]||(e[15]=a=>n.lng=a),"search-address":n.address},null,8,["lat","lng","search-address"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ma=X(oa,[["__scopeId","data-v-8296085f"]]);export{ma as default};
