import{s as B,d as N,r as T,c as V,b as n,a0 as M,w as a,Q as O,e as h,P as p,a7 as m,D as $,T as F,l as y,i as Q,L as A,k as S,p as c,_ as D,o as R,E as j,m as g,a8 as q,a9 as H,A as J,B as W,a4 as X,$ as z}from"./index-Bh04lDP-.js";/* empty css                *//* empty css                        *//* empty css                 */const Y=()=>B({url:"/system/config/list",method:"GET"}),Z=v=>B({url:"/system/config/update",method:"POST",data:v}),ee=()=>B({url:"/system/config/reload",method:"POST"}),ae=v=>B({url:`/system/config/test/${v}`,method:"POST"}),te={class:"config-group"},ne={class:"config-name"},se={class:"config-value"},oe={key:1,class:"value-text"},le={class:"action-buttons"},ie=N({__name:"ConfigGroup",props:{configs:{}},emits:["update","test"],setup(v,{emit:K}){const b=K,t=T(null),r=T(""),u=T(""),d=e=>["api.key","password","secret","token","access.key"].some(C=>e.toLowerCase().includes(C)),P=e=>e.encrypted||d(e.configKey)?"********":e.configValue||"未设置",I=e=>["spring.ai.openai.api-key","spring.ai.openai.base-url","spring.data.redis.host","spring.datasource.url","minio.endpoint","amap.key"].includes(e),s=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",l=e=>{t.value=e.configKey,r.value=e.configValue,u.value=e.configValue},_=e=>{if(r.value===u.value){t.value=null;return}b("update",{...e,configValue:r.value}),t.value=null},U=()=>{t.value=null,r.value=""},f=e=>{b("test",e)};return(e,o)=>{const C=F,x=O,G=Q,w=S,L=M;return c(),V("div",te,[n(L,{data:v.configs,border:"",stripe:""},{default:a(()=>[n(x,{prop:"description",label:"配置项",width:"200"},{default:a(({row:i})=>[h("div",ne,[h("span",null,$(i.description||i.configKey),1),i.encrypted?(c(),p(C,{key:0,size:"small",type:"warning",style:{"margin-left":"8px"}},{default:a(()=>[...o[1]||(o[1]=[y(" 加密 ",-1)])]),_:1})):m("",!0)])]),_:1}),n(x,{prop:"configKey",label:"配置键",width:"250"}),n(x,{label:"配置值","min-width":"300"},{default:a(({row:i})=>[h("div",se,[t.value===i.configKey?(c(),p(G,{key:0,modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=E=>r.value=E),type:d(i.configKey)?"password":"text",placeholder:"请输入配置值","show-password":""},null,8,["modelValue","type"])):(c(),V("span",oe,$(P(i)),1))])]),_:1}),n(x,{label:"更新时间",width:"180"},{default:a(({row:i})=>[y($(s(i.updatedAt)),1)]),_:1}),n(x,{label:"操作",width:"200",fixed:"right"},{default:a(({row:i})=>[h("div",le,[t.value===i.configKey?(c(),V(A,{key:0},[n(w,{type:"primary",size:"small",onClick:E=>_(i)},{default:a(()=>[...o[2]||(o[2]=[y(" 保存 ",-1)])]),_:1},8,["onClick"]),n(w,{size:"small",onClick:U},{default:a(()=>[...o[3]||(o[3]=[y(" 取消 ",-1)])]),_:1})],64)):(c(),V(A,{key:1},[n(w,{type:"primary",size:"small",onClick:E=>l(i)},{default:a(()=>[...o[4]||(o[4]=[y(" 编辑 ",-1)])]),_:1},8,["onClick"]),I(i.configKey)?(c(),p(w,{key:0,type:"success",size:"small",onClick:E=>f(i.configKey)},{default:a(()=>[...o[5]||(o[5]=[y(" 测试 ",-1)])]),_:1},8,["onClick"])):m("",!0)],64))])]),_:1})]),_:1},8,["data"])])}}}),k=D(ie,[["__scopeId","data-v-b8ee842e"]]),ce={class:"config-container"},re={class:"card-header"},ue=N({__name:"config",setup(v){const K=T("ai"),b=T(!1),t=T({ai:[],database:[],cache:[],storage:[],map:[],external:[]}),r=async()=>{try{const s=await Y();s.code===0&&(t.value=s.data)}catch{g.error("加载配置失败")}},u=async s=>{try{await z.confirm(`确定要更新配置 "${s.description||s.configKey}" 吗？`,"确认更新",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Z({configKey:s.configKey,configValue:s.configValue,description:s.description})).code===0&&(g.success("配置更新成功"),await r())}catch(l){l!=="cancel"&&g.error("配置更新失败")}},d=async s=>{try{const l=await ae(s);if(l.code===0){const _=l.data;_.success?g.success(_.message||"连接测试成功"):g.error(_.message||"连接测试失败")}}catch{g.error("连接测试失败")}},P=async()=>{try{await z.confirm("重新加载配置会使所有配置从数据库重新读取，确定要继续吗？","确认重新加载",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),b.value=!0,(await ee()).code===0&&(g.success("配置重新加载成功"),await r())}catch(s){s!=="cancel"&&g.error("配置重新加载失败")}finally{b.value=!1}},I=s=>{console.log("切换到标签页:",s)};return R(()=>{r()}),(s,l)=>{const _=J,U=S,f=H,e=q,o=j;return c(),V("div",ce,[n(o,null,{header:a(()=>[h("div",re,[l[2]||(l[2]=h("span",{class:"title"},"系统配置管理",-1)),n(U,{type:"primary",onClick:P,loading:b.value},{default:a(()=>[n(_,null,{default:a(()=>[n(W(X))]),_:1}),l[1]||(l[1]=y(" 重新加载配置 ",-1))]),_:1},8,["loading"])])]),default:a(()=>[n(e,{modelValue:K.value,"onUpdate:modelValue":l[0]||(l[0]=C=>K.value=C),onTabChange:I},{default:a(()=>[n(f,{label:"AI 配置",name:"ai"},{default:a(()=>[t.value.ai?(c(),p(k,{key:0,configs:t.value.ai,onUpdate:u,onTest:d},null,8,["configs"])):m("",!0)]),_:1}),n(f,{label:"数据库配置",name:"database"},{default:a(()=>[t.value.database?(c(),p(k,{key:0,configs:t.value.database,onUpdate:u,onTest:d},null,8,["configs"])):m("",!0)]),_:1}),n(f,{label:"缓存配置",name:"cache"},{default:a(()=>[t.value.cache?(c(),p(k,{key:0,configs:t.value.cache,onUpdate:u,onTest:d},null,8,["configs"])):m("",!0)]),_:1}),n(f,{label:"存储配置",name:"storage"},{default:a(()=>[t.value.storage?(c(),p(k,{key:0,configs:t.value.storage,onUpdate:u,onTest:d},null,8,["configs"])):m("",!0)]),_:1}),n(f,{label:"地图配置",name:"map"},{default:a(()=>[t.value.map?(c(),p(k,{key:0,configs:t.value.map,onUpdate:u,onTest:d},null,8,["configs"])):m("",!0)]),_:1}),n(f,{label:"外部服务",name:"external"},{default:a(()=>[t.value.external?(c(),p(k,{key:0,configs:t.value.external,onUpdate:u,onTest:d},null,8,["configs"])):m("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),me=D(ue,[["__scopeId","data-v-963e067c"]]);export{me as default};
