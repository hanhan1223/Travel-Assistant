import{s as I,d as ie,r as u,I as N,o as de,c as C,b as l,w as a,E as re,J as se,f as ue,h as pe,i as ce,j as fe,K as me,L as R,M,k as ge,B as j,N as _e,l as d,a4 as ve,e as _,t as ye,a5 as be,v as Ie,P as x,Q as we,A as ke,a6 as he,D as E,T as Ce,W as je,X as xe,m as b,$ as Ee,a0 as Se,p,a1 as Ve,_ as ze}from"./index-Bh04lDP-.js";/* empty css                   */import{g as Pe}from"./ich-Dffa0FPv.js";/* empty css                    *//* empty css                        *//* empty css                 *//* empty css                *//* empty css                     */const Te=r=>I({url:"/knowledge/upload",method:"POST",data:r,headers:{"Content-Type":"multipart/form-data"}}),De=r=>I({url:"/knowledge/list",method:"POST",data:r}),Ue=r=>I({url:`/knowledge/${r}`,method:"DELETE"}),Le=r=>I({url:`/knowledge/revectorize/${r}`,method:"POST"}),$e=(r,c)=>I({url:`/knowledge/update/${r}`,method:"PUT",data:c,headers:{"Content-Type":"multipart/form-data"}}),Ae={class:"app-container"},Ke={class:"toolbar"},Be={style:{display:"flex","align-items":"center"}},Oe={style:{"margin-left":"8px","font-weight":"500"}},qe={style:{"font-size":"12px",color:"#999","margin-left":"24px"}},Ne={key:1,style:{color:"#999","font-size":"12px"}},Re={class:"pagination"},Me={class:"dialog-footer"},Fe=ie({__name:"index",setup(r){const c=u(!1),P=u([]),T=u(0),w=u([]),i=N({current:1,pageSize:10,title:"",projectId:void 0}),v=u(!1),y=u("add"),S=u(!1),V=u(),n=N({id:void 0,title:"",projectId:void 0,file:null}),k=u([]),F={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],projectId:[{required:!0,message:"请选择关联非遗项目",trigger:"change"}]},D=o=>{const e=w.value.find(h=>h.id===o);return e?e.name:null},H=async()=>{try{const o=await Pe({current:1,pageSize:100});w.value=o.data.records}catch(o){console.error("获取项目列表失败",o)}},f=async()=>{c.value=!0;try{const o=await De(i);P.value=o.data.records,T.value=typeof o.data.total=="string"?parseInt(o.data.total):o.data.total}finally{c.value=!1}},z=()=>{i.current=1,f()},J=()=>{i.title="",i.projectId=void 0,z()},U=(o,e)=>{y.value=o,v.value=!0,k.value=[],o==="edit"&&e?(n.id=e.id,n.title=e.title,n.projectId=e.projectId,n.file=null):(n.id=void 0,n.title="",n.projectId=void 0,n.file=null)},Q=o=>{if(o.raw&&(n.file=o.raw,!n.title)){const e=o.name;n.title=e.substring(0,e.lastIndexOf("."))}k.value.length>1&&k.value.splice(0,1)},W=async()=>{V.value&&await V.value.validate(async o=>{if(o){if(y.value==="add"&&!n.file){b.warning("请上传文档文件");return}S.value=!0;try{const e=new FormData;e.append("title",n.title),n.projectId&&e.append("projectId",n.projectId.toString()),n.file&&e.append("file",n.file),y.value==="add"?(await Te(e),b.success("上传成功")):n.id&&(await $e(n.id,e),b.success("更新成功")),v.value=!1,f()}finally{S.value=!1}}})},X=o=>{Ee.confirm("确定删除吗？","提示").then(async()=>{await Ue(o.id),b.success("删除成功"),f()})},G=async o=>{try{c.value=!0,await Le(o.id),b.success("已触发重向量化"),f()}finally{c.value=!1}},Y=o=>{i.current=o,f()},Z=o=>{i.pageSize=o,i.current=1,f()},L=o=>({2:{type:"success",label:"已完成"},1:{type:"warning",label:"处理中"},3:{type:"danger",label:"失败"},0:{type:"info",label:"待处理"}})[o]||{type:"info",label:"未知"};return de(()=>{H(),f()}),(o,e)=>{const h=ce,g=pe,$=Ve,A=me,s=ge,K=ue,B=re,m=we,ee=ke,O=Ce,te=Se,le=je,ae=xe,oe=se,ne=Ie;return p(),C("div",Ae,[l(B,{shadow:"never",class:"search-card"},{default:a(()=>[l(K,{inline:!0,model:i},{default:a(()=>[l(g,{label:"文档标题"},{default:a(()=>[l(h,{modelValue:i.title,"onUpdate:modelValue":e[0]||(e[0]=t=>i.title=t),placeholder:"请输入标题关键词",clearable:"",onKeyup:fe(z,["enter"])},null,8,["modelValue"])]),_:1}),l(g,{label:"关联项目"},{default:a(()=>[l(A,{modelValue:i.projectId,"onUpdate:modelValue":e[1]||(e[1]=t=>i.projectId=t),placeholder:"选择关联项目",clearable:"",style:{width:"200px"}},{default:a(()=>[(p(!0),C(R,null,M(w.value,t=>(p(),x($,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,null,{default:a(()=>[l(s,{type:"primary",icon:j(_e),onClick:z},{default:a(()=>[...e[9]||(e[9]=[d("搜索",-1)])]),_:1},8,["icon"]),l(s,{icon:j(ve),onClick:J},{default:a(()=>[...e[10]||(e[10]=[d("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(B,{shadow:"never",class:"table-card"},{default:a(()=>[_("div",Ke,[l(s,{type:"primary",icon:j(be),onClick:e[2]||(e[2]=t=>U("add"))},{default:a(()=>[...e[11]||(e[11]=[d("上传新文档",-1)])]),_:1},8,["icon"])]),ye((p(),x(te,{data:P.value,border:"",style:{width:"100%"}},{default:a(()=>[l(m,{prop:"id",label:"ID",width:"80",align:"center"}),l(m,{label:"文档信息","min-width":"200"},{default:a(({row:t})=>[_("div",Be,[l(ee,{class:"mr-2"},{default:a(()=>[l(j(he))]),_:1}),_("span",Oe,E(t.title),1)]),_("div",qe,"文件名: "+E(t.fileUrl?t.fileUrl.split("/").pop():"未知"),1)]),_:1}),l(m,{label:"关联项目",width:"150",align:"center"},{default:a(({row:t})=>[t.projectId&&D(t.projectId)?(p(),x(O,{key:0,effect:"plain"},{default:a(()=>[d(E(D(t.projectId)),1)]),_:2},1024)):(p(),C("span",Ne,"暂无"))]),_:1}),l(m,{label:"切片状态",width:"120",align:"center"},{default:a(({row:t})=>[l(O,{type:L(t.vectorStatus).type},{default:a(()=>[d(E(L(t.vectorStatus).label),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"chunkCount",label:"切片数",width:"100",align:"center"}),l(m,{prop:"createdAt",label:"上传时间",width:"180",align:"center"}),l(m,{label:"操作",width:"220",fixed:"right",align:"center"},{default:a(({row:t})=>[l(s,{link:"",type:"primary",onClick:q=>U("edit",t)},{default:a(()=>[...e[12]||(e[12]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(s,{link:"",type:"warning",onClick:q=>G(t)},{default:a(()=>[...e[13]||(e[13]=[d("重新向量化",-1)])]),_:1},8,["onClick"]),l(s,{link:"",type:"danger",onClick:q=>X(t)},{default:a(()=>[...e[14]||(e[14]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,c.value]]),_("div",Re,[l(le,{"current-page":i.current,"onUpdate:currentPage":e[3]||(e[3]=t=>i.current=t),"page-size":i.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>i.pageSize=t),total:T.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:Y,onSizeChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),l(oe,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=t=>v.value=t),title:y.value==="add"?"上传文档":"编辑文档",width:"500px"},{footer:a(()=>[_("span",Me,[l(s,{onClick:e[7]||(e[7]=t=>v.value=!1)},{default:a(()=>[...e[16]||(e[16]=[d("取消",-1)])]),_:1}),l(s,{type:"primary",loading:S.value,onClick:W},{default:a(()=>[...e[17]||(e[17]=[d("保存修改",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l(K,{ref_key:"formRef",ref:V,model:n,rules:F,"label-width":"100px"},{default:a(()=>[l(g,{label:"文档标题",prop:"title"},{default:a(()=>[l(h,{modelValue:n.title,"onUpdate:modelValue":e[5]||(e[5]=t=>n.title=t),placeholder:"请输入文档展示标题"},null,8,["modelValue"])]),_:1}),l(g,{label:"关联项目",prop:"projectId"},{default:a(()=>[l(A,{modelValue:n.projectId,"onUpdate:modelValue":e[6]||(e[6]=t=>n.projectId=t),placeholder:"请选择关联非遗项目",style:{width:"100%"},clearable:""},{default:a(()=>[(p(!0),C(R,null,M(w.value,t=>(p(),x($,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"文档文件",required:y.value==="add"},{default:a(()=>[l(ae,{ref:"uploadRef",action:"#","auto-upload":!1,"on-change":Q,"file-list":k.value,limit:1,accept:".pdf,.doc,.docx,.txt,.md"},{trigger:a(()=>[l(s,{type:"primary"},{default:a(()=>[...e[15]||(e[15]=[d("选择文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1},8,["required"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),et=ze(Fe,[["__scopeId","data-v-b1182ffc"]]);export{et as default};
